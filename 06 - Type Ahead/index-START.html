<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>

const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

const cities = [];
fetch(endpoint)
  .then(blob => blob.json())
  .then(data => cities.push(...data));

// fetch - requestë‚˜ responseì™€ ê°™ì€ HTTPì˜ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ëŠ” ìš”ì†Œë¥¼ ì¡°ì‘í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥
// ì²« ë²ˆì§¸ ì¸ìë¡œ Url, ë‘ ë²ˆì§¸ ì¸ìë¡œ ì˜µì…˜ ê°ì²´ë¥¼ ë°›ê³  Promise íƒ€ì…ì˜ ê°ì²´ë¥¼ ë°˜í™˜í•¨

const findMatches = (wordToMatch, cities) => {
  return cities.filter(place => {
    const regex = new RegExp(wordToMatch, 'gi'); // ë¬¸ìì—´ ì „ì²´íŒë³„, ëŒ€ì†Œë¬¸ì ë¬´ì‹œ
    return place.city.match(regex) || place.state.match(regex)
  });
}
/*
  ê²€ìƒ‰ì‹œ ë‹¨ì–´ê°€ ì¼ì¹˜í•˜ëŠ” ë„ì‹œ ë˜ëŠ” ì£¼ë¥¼ ë°˜í™˜í•˜ëŠ” ë³€ìˆ˜ regexë¥¼ ë§Œë“¤ê³  citiesì— í•„í„°ë¥¼ ì ìš©í•´ ë°˜í™˜í•˜ë„ë¡ í•˜ëŠ” findMatches í•¨ìˆ˜ë¥¼ ë§Œë“ ë‹¤.
  ì´ ë•Œ, RegExpëŠ” ê²€ìƒ‰í•  ë•Œ íŒ¨í„´ì„ ì„¤ì •í•´ ì¤„ ìˆ˜ ìˆëŠ” ìƒì„±ìì´ë‹¤.
*/

function displayMatches() {
  console.log(this.value);
  const matchArray = findMatches(this.value, cities);
  const html = matchArray.map(place => {
    const regex = new RegExp(this.value, 'gi'); 
    const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`); 
    const stateName = place.state.replace(regex, `<span class="hl">${this.value}</span>`);
    return ` 
      <li> 
        <span class="name">${cityName}, ${stateName}</span> 
        <span class="population">${numberWithCommas(place.population)}</span> 
      </li> `; 
    }).join(''); 
    suggestions.innerHTML = html;
}
/*
  matchArrayì— ì¼ì¹˜í•˜ëŠ” ê°’ì„ ë‹´ê³ , htmlì— ê²€ìƒ‰ í›„ì— ë°°ì—´ì—ì„œ ì¼ì¹˜í•˜ëŠ” ë‚´ìš©ì„ ì°¾ì•„
  cityName, stateNameì— ìƒˆë¡œìš´ ê²€ìƒ‰ê°’ì´ ë“¤ì–´ê°„ htmlíƒœê·¸ë¡œ ëŒ€ì²´í•˜ë„ë¡ í•˜ê³ , ìƒˆë¡œìš´ ë¦¬ìŠ¤íŠ¸ íƒœê·¸ë¥¼ ë°˜í™˜
  ê³µë°±ìœ¼ë¡œ ì„œë¡œ ì—°ê²°í•˜ê²Œ í•´ì„œ suggestionsì— html ë‚´ìš©ì„ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‚½ì…í•˜ëŠ” ëª¨ë“  ê³¼ì •

*/

// ì¸êµ¬ìˆ˜ë¥¼ ë³´ê¸° í¸í•˜ê²Œ ì½¤ë§ˆ ì‚½ì…
const numberWithCommas = (x) => {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

// ì‹¤ì‹œê°„ìœ¼ë¡œ ë¸Œë¼ìš°ì €ì— ì¶œë ¥
const searchInput = document.querySelector('.search');
const suggestions = document.querySelector('.suggestions');

 searchInput.addEventListener('change', displayMatches);
 searchInput.addEventListener('keyup', displayMatches);
</script>
</body>
</html>
